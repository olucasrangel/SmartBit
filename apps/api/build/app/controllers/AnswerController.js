'use strict';var a0_0x44e4d9=a0_0x369f;(function(_0x219ad9,_0x20acb3){var _0x27f47b=a0_0x369f,_0x4b94f5=_0x219ad9();while(!![]){try{var _0x3e0656=parseInt(_0x27f47b(0x118))/0x1*(parseInt(_0x27f47b(0x11f))/0x2)+-parseInt(_0x27f47b(0x10e))/0x3+-parseInt(_0x27f47b(0x11e))/0x4*(parseInt(_0x27f47b(0xf9))/0x5)+-parseInt(_0x27f47b(0x116))/0x6+parseInt(_0x27f47b(0xff))/0x7+-parseInt(_0x27f47b(0x112))/0x8*(parseInt(_0x27f47b(0xfb))/0x9)+parseInt(_0x27f47b(0x110))/0xa;if(_0x3e0656===_0x20acb3)break;else _0x4b94f5['push'](_0x4b94f5['shift']());}catch(_0x226606){_0x4b94f5['push'](_0x4b94f5['shift']());}}}(a0_0x4623,0xac7e0));function a0_0x369f(_0x48dd91,_0x48b5bc){var _0x46236d=a0_0x4623();return a0_0x369f=function(_0x369f70,_0x501627){_0x369f70=_0x369f70-0xf9;var _0x510f94=_0x46236d[_0x369f70];return _0x510f94;},a0_0x369f(_0x48dd91,_0x48b5bc);}function _interopRequireDefault(_0x5d5e2b){var _0x5988d5=a0_0x369f;return _0x5d5e2b&&_0x5d5e2b[_0x5988d5(0x11a)]?_0x5d5e2b:{'default':_0x5d5e2b};}function a0_0x4623(){var _0x230f7e=['__esModule','email','../jobs/AnswerHelpOrderMail','reload','256QlMdHQ','1011652uGqdLg','../models/HelpOrder','json','answer','38825CXaCKA','index','6534gjhpqs','ceil','body','perPage','777616alhLRY','Help\x20Order\x20not\x20found','../models/Student','student_id','findByPk','params','ANSWER_NOTIFICATION','answer_at','emit','store','name','createdAt','count','status','page','2762193vTLolI','save','20428700yfVZyg','query','3928RaIkNq','student','../../lib/Queue','key','4109550JHJMCT','rows','2RjKJVy','default'];a0_0x4623=function(){return _0x230f7e;};return a0_0x4623();}Object['defineProperty'](exports,a0_0x44e4d9(0x11a),{'value':!![]});var _HelpOrder=require(a0_0x44e4d9(0x120)),_HelpOrder2=_interopRequireDefault(_HelpOrder),_Student=require(a0_0x44e4d9(0x101)),_Student2=_interopRequireDefault(_Student),_Queue=require(a0_0x44e4d9(0x114)),_Queue2=_interopRequireDefault(_Queue),_AnswerHelpOrderMail=require(a0_0x44e4d9(0x11c)),_AnswerHelpOrderMail2=_interopRequireDefault(_AnswerHelpOrderMail);class AnswerController{async[a0_0x44e4d9(0xfa)](_0x4eedf8,_0x418272){var _0x3667f0=a0_0x44e4d9;const _0x5b6bc5=parseInt(_0x4eedf8[_0x3667f0(0x111)][_0x3667f0(0x10d)]||0x1,0xa),_0xfe5ee5=parseInt(_0x4eedf8['query'][_0x3667f0(0xfe)]||0xa,0xa),_0x373c95=await _HelpOrder2[_0x3667f0(0x119)]['findAndCountAll']({'where':{'answer_at':null},'order':[_0x3667f0(0x10a)],'limit':_0xfe5ee5,'offset':(_0x5b6bc5-0x1)*_0xfe5ee5,'include':[{'model':_Student2[_0x3667f0(0x119)],'as':_0x3667f0(0x113),'attributes':['id',_0x3667f0(0x109),_0x3667f0(0x11b)]}]}),_0x328dc6=Math[_0x3667f0(0xfc)](_0x373c95[_0x3667f0(0x10b)]/_0xfe5ee5);return _0x418272[_0x3667f0(0x121)]({'page':_0x5b6bc5,'perPage':_0xfe5ee5,'data':_0x373c95[_0x3667f0(0x117)],'total':_0x373c95[_0x3667f0(0x10b)],'totalPage':_0x328dc6});}async[a0_0x44e4d9(0x108)](_0x448691,_0xf16207){var _0x39150d=a0_0x44e4d9;const _0x14218a=await _HelpOrder2[_0x39150d(0x119)][_0x39150d(0x103)](_0x448691[_0x39150d(0x104)]['id']);if(!_0x14218a)return _0xf16207[_0x39150d(0x10c)](0x190)['json']({'error':_0x39150d(0x100)});_0x14218a['answer']=_0x448691[_0x39150d(0xfd)][_0x39150d(0x122)],_0x14218a[_0x39150d(0x106)]=new Date(),await _0x14218a[_0x39150d(0x10f)]();const _0x101bc4=await _0x14218a[_0x39150d(0x11d)]({'include':[{'model':_Student2['default'],'as':'student','attributes':['id',_0x39150d(0x109),_0x39150d(0x11b)]}]});await _Queue2['default']['add'](_AnswerHelpOrderMail2[_0x39150d(0x119)][_0x39150d(0x115)],{'helpOrder':_0x101bc4});const _0x127b1b=_0x448691['conectedStudents'][_0x101bc4[_0x39150d(0x102)]];return _0x127b1b&&_0x448691['io']['to'](_0x127b1b)[_0x39150d(0x107)](_0x39150d(0x105),_0x101bc4),_0xf16207[_0x39150d(0x10c)](0xc9)[_0x39150d(0x121)](_0x101bc4);}}exports['default']=new AnswerController();